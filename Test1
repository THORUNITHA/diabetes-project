#!/bin/bash

PORT=22601
TML_BIN="/apps/tml/Allocation/processes/tmltradeloader"
JAVA_HOME="/path/to/java"
CURRENT_ENV="your_env"

# Find process using the port
TARGET_PID=$(lsof -ti :$PORT)

if [ -n "$TARGET_PID" ]; then
    echo "Stopping process on port $PORT with PID: $TARGET_PID"

    # Try to shut down using Java command
    sudo "$JAVA_HOME/bin/java" -cp "$TML_BIN/tmltradeloader-2.0.13.jar" -Denv="$CURRENT_ENV" com.baml.tmi.tmltradeloader.main.TmlTradeLoaderNamMain shutdown $PORT
    sleep 5

    # Check if process is still running
    if ps -p "$TARGET_PID" > /dev/null; then
        echo "Process still running on port $PORT. Force killing..."
        kill -9 "$TARGET_PID"
    fi

    echo "Shutdown complete."
else
    echo "No process found on port $PORT."
fi
